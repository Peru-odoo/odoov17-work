<?xml version="1.0" encoding="UTF-8" ?>
<templates xml:space="preserve">
    <t t-name="lotteries.ForecastItems">
        <t t-if="Array.isArray(props.results) &amp;&amp; props.results.length">
            <div>
                <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                    <h2 class="mb-0">Resultados de Frecuencia</h2>
                    <input type="text"
                        id="searchInput"
                        placeholder="Buscar nÃºmero..."
                        onkeyup="filterTable()"
                        class="form-control form-control-sm"
                        style="max-width: 250px;" />
                </div>

                <table class="table table-striped" id="frequencyTable">
                    <thead>
                        <tr>
                            <th>NÃºmero</th>
                            <th>Frecuencia</th>
                            <th>Prom. DÃ­as</th>
                            <th>Ãšltima Fecha</th>
                            <th>Todas las Fechas</th>
                        </tr>
                    </thead>
                    <tbody>
                        <t t-foreach="props.results" t-as="row" t-key="row.number">
                            <tr>
                                <td><t t-esc="row['number']" /></td>
                                <td><t t-esc="row['frequency']" /></td>
                                <td><t t-esc="row['avg_days_between']" /></td>
                                <td><t t-esc="row['last_seen']" /></td>
                                <td>
                                    <!-- BotÃ³n Toggle para las fechas -->
                                    <button t-on-click="toggleDates"
                                            class="btn btn-sm btn-light border d-flex align-items-center gap-2 shadow-sm"
                                            t-att-aria-expanded="state.showDates"
                                            t-att-aria-label="state.showDates ? 'Hide dates' : 'Show dates'">
                                        <span><t t-esc="state.showDates ? 'Hide Dates' : 'Show Dates'" /></span>
                                        <i class="fa" t-att-class="state.showDates ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                                    </button>

                                    <!-- Listado de Fechas -->
                                    <ul t-if="state.showDates">
                                        <div class="mt-2">
                                            <div class="list-group">
                                                <t t-foreach="row['all_dates']" t-as="date" t-key="date">
                                                    <t t-if="date != row['last_seen']">
                                                        <div class="list-group-item d-flex justify-content-between align-items-center">
                                                            <i class="fa fa-calendar text-primary me-2"></i>
                                                            <span class="flex-grow-1"><t t-esc="date" /></span>
                                                            <span class="badge bg-secondary">ðŸ“…</span>
                                                        </div>
                                                    </t>
                                                </t>
                                            </div>
                                        </div>
                                    </ul>
                                </td>
                            </tr>
                        </t>
                    </tbody>
                </table>
            </div>
        </t>
        <t t-else="">
            <p class="text-center text-muted">No hay resultados para mostrar.</p>
        </t>

        <!-- Filtro por JS -->
        <script type="text/javascript">
            <![CDATA[
            function filterTable() {
                const input = document.getElementById("searchInput");
                const filter = input.value.toUpperCase();
                const table = document.getElementById("frequencyTable");
                const tr = table.getElementsByTagName("tr");

                for (let i = 1; i < tr.length; i++) {
                    const td = tr[i].getElementsByTagName("td")[0];
                    if (td) {
                        const txtValue = td.textContent || td.innerText;
                        tr[i].style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
                    }
                }
            }
            ]]>
        </script>
    </t>
</templates>